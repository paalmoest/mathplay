--DROPS--
DROP TABLE users;
DROP TABLE roles;
DROP TABLE user_roles;
DROP TABLE student;
DROP TABLE teacher;
DROP TABLE student_teacher;
DROP TABLE tasks;
DROP TABLE task_name;
DROP TABLE task_type;
DROP TABLE task_teacher;
DROP TABLE task_student;
DROP TABLE playerinfo;


--Brukertabell: brukernavn, passord--
CREATE TABLE users(
    user_id INTEGER PRIMARY KEY GENERATED ALWAYS AS IDENTITY(START WITH 1, INCREMENT BY 1),
    username VARCHAR(20),
    password VARCHAR(20),
    firstname VARCHAR(20),
    lastname VARCHAR(20)
);

--Rolletabell: forskjellige roller--
CREATE TABLE roles(
    rolename VARCHAR(20) PRIMARY KEY
);

--Bruker/Roller: koblingstabell--
CREATE TABLE user_roles(
    user_id INT,
    rolename VARCHAR(20),
    CONSTRAINT user_roles_pk PRIMARY KEY(user_id, rolename)
);

--Student/Lærer: koblingstabell--
CREATE TABLE student_teacher(
    user_id INT,
    username VARCHAR(20),
    CONSTRAINT student_teacher_pk PRIMARY KEY(user_id,username)
);

--Oppgavetabell: oppgaveinfo--
CREATE TABLE tasks(
    task_id INTEGER PRIMARY KEY GENERATED ALWAYS AS IDENTITY(START WITH 1, INCREMENT BY 1),
    task_text VARCHAR(20),
    answer DOUBLE,
    difficulty INT,
    task_type VARCHAR(20)
);

--Oppgavetype: forskjellige type oppgaver--
CREATE TABLE task_name(
    task_type VARCHAR(20) PRIMARY KEY
);

--Oppgave/Type: koblingstabell--
CREATE TABLE task_type(
    task_id INT,
    task_type VARCHAR(20),
    CONSTRAINT task_type_pk PRIMARY KEY(task_id, task_type)
);

--Oppgave/Lærer: koblingstabell--
CREATE TABLE task_teacher(
    task_id INT,
    user_id INT,
    CONSTRAINT task_teacher_pk PRIMARY KEY(task_id, user_id)
);

--Oppgave/Student: koblingstabell--
CREATE TABLE task_student(
    task_id INT,
    user_id INT,
    solved VARCHAR(10),
    CONSTRAINT task_student_pk PRIMARY KEY(task_id, user_id)
);

--Spillerinto: Valutta osv--
CREATE TABLE playerinfo(
    user_id INT,
    addition_score INT,
    subtraction_score INT,
    multiplication_score INT,
    division_score INT
);

--Fremmednøkler--
--Koblingstabeller--
ALTER TABLE user_roles ADD CONSTRAINT user_roles_fk1 FOREIGN KEY(user_id) REFERENCES users;
ALTER TABLE user_roles ADD CONSTRAINT user_roles_fk2 FOREIGN KEY(rolename) REFERENCES roles;
ALTER TABLE task_type ADD CONSTRAINT task_type_fk1 FOREIGN KEY(task_id) REFERENCES tasks;
ALTER TABLE task_type ADD CONSTRAINT task_type_fk2 FOREIGN KEY(task_type) REFERENCES task_name;
ALTER TABLE task_teacher ADD CONSTRAINT task_teacher_fk1 FOREIGN KEY(task_id) REFERENCES tasks;
ALTER TABLE task_teacher ADD CONSTRAINT task_teacher_fk2 FOREIGN KEY(user_id) REFERENCES tasks;
ALTER TABLE student_teacher ADD CONSTRAINT student_teacher_fk1 FOREIGN KEY(user_id) REFERENCES tasks;
ALTER TABLE student_teacher ADD CONSTRAINT student_teacher_fk2 FOREIGN KEY(username) REFERENCES tasks;
ALTER TABLE task_student ADD CONSTRAINT task_student_fk1 FOREIGN KEY(task_id) REFERENCES tasks;
ALTER TABLE task_student ADD CONSTRAINT task_student_fk2 FOREIGN KEY(user_id) REFERENCES tasks;
--STANDALONES!--
ALTER TABLE playerinfo ADD CONSTRAINT playerinfo_fk1 FOREIGN KEY(user_id) REFERENCES users;

--INSERTS--
--Legger til brukere--
INSERT INTO USERS (USERNAME, PASSWORD, FIRSTNAME, LASTNAME) VALUES ('stian', 'hei', 'Stian', 'Sørebø')
INSERT INTO USERS (USERNAME, PASSWORD, FIRSTNAME, LASTNAME) VALUES ('andriod', 'noob', 'Andrej', 'Skogsland')
--Lager roller--
INSERT INTO ROLES (ROLENAME) VALUES ('admin')
INSERT INTO ROLES (ROLENAME) VALUES ('user')
--Binder brukere til roller--
INSERT INTO USER_ROLES (USER_ID, ROLENAME)VALUES (1, 'admin')
INSERT INTO USER_ROLES (USER_ID, ROLENAME)VALUES (2, 'user')
--Lager oppgavetyper--
INSERT INTO TASK_NAME (TASK_TYPE)VALUES ('Multiplikasjon')
--Lager oppgaver--
INSERT INTO TASKS (TASK_TEXT, ANSWER, DIFFICULTY, TASK_TYPE)VALUES ('Hva er 2+2?', 4.0, 1, 'Multiplikasjon')
--Binder oppgave til oppgavetype--
INSERT INTO TASK_TYPE (TASK_ID, TASK_TYPE)VALUES (1, 'Multiplikasjon')
--Binder oppgave til lærer--
INSERT INTO TASK_TEACHER (TASK_ID, USER_ID)VALUES (1, 1)
--Binder oppgave til student og setter gjort--
INSERT INTO TASK_STUDENT (TASK_ID, USER_ID, SOLVED) VALUES (1, 2, 'JA!')
--Binder Lærer til student--
INSERT INTO STUDENT_TEACHER (USER_ID, USERNAME)VALUES (1, 'andriod')
--Setter player score---
INSERT INTO PLAYERINFO (USER_ID, ADDITION_SCORE, SUBTRACTION_SCORE, MULTIPLICATION_SCORE, DIVISION_SCORE)VALUES (1, 2, 3, 4, 5)

